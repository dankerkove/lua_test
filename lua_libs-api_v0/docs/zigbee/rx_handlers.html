
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Zigbee Driver RX message handlers &#8212; SmartThings Lua Libraries  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Zigbee Driver Capability Command Handlers" href="tx_handlers.html" />
    <link rel="prev" title="Zigbee driver sturctures" href="drivers.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="zigbee-driver-rx-message-handlers">
<h1>Zigbee Driver RX message handlers<a class="headerlink" href="#zigbee-driver-rx-message-handlers" title="Permalink to this headline">¶</a></h1>
<p>These are handlers that can be used to use any incoming <a class="reference internal" href="messages.html#messages.ZigbeeMessageRx" title="messages.ZigbeeMessageRx"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">ZigbeeMessageRx</span></code></a>.  In
general there are 4 common types of handlers that can be simply defined and automatically handled by the driver
infrastructure.  These are 1) ZCL attribute value handlers, 2) ZCL global command handlers, 3) ZCL cluster specific
command handlers, and 4) ZDO handlers. A further description of each is provided below.</p>
<p>In order for one of these message handlers to be registered the driver will provide a table with the registrations
included in it.  There are also included a number of default handlers that can be registered based on a list of
capaibilties.  This can be done using:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">defaults</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;st.zigbee.defaults&quot;</span>
<span class="n">defaults</span><span class="p">.</span><span class="n">register_for_default_handlers</span><span class="p">(</span><span class="n">driver_template</span><span class="p">,</span> <span class="p">{</span> <span class="n">capabilities</span><span class="p">.</span><span class="n">switch</span><span class="p">,</span> <span class="n">capabilities</span><span class="p">.</span><span class="n">switchLevel</span> <span class="p">})</span>
</pre></div>
</div>
<p>These defaults can be overriden explicitly, never registered, or left as is
and just expanded by registering additional handlers.  Following is an example of additional handlers added in a driver:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">generate_event_from_zone_status</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">zone_status</span><span class="p">)</span>
  <span class="n">capabilities</span><span class="p">.</span><span class="n">emit_event</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">driver</span><span class="p">.</span><span class="n">capability_socket</span><span class="p">,</span> <span class="p">(</span><span class="n">zone_status</span><span class="p">:</span><span class="n">is_alarm1_set</span><span class="p">()</span> <span class="ow">or</span> <span class="n">zone_status</span><span class="p">:</span><span class="n">is_alarm2_set</span><span class="p">())</span> <span class="ow">and</span> <span class="n">capabilities</span><span class="p">.</span><span class="n">WaterSensor</span><span class="p">.</span><span class="n">water</span><span class="p">.</span><span class="n">wet</span><span class="p">()</span> <span class="ow">or</span> <span class="n">capabilities</span><span class="p">.</span><span class="n">WaterSensor</span><span class="p">.</span><span class="n">water</span><span class="p">.</span><span class="n">dry</span><span class="p">())</span>
<span class="kr">end</span>

<span class="kd">local</span> <span class="n">ias_zone_status_attr_handler</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">attr_val</span><span class="p">)</span>
  <span class="n">generate_event_from_zone_status</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">ZoneStatus</span><span class="p">(</span><span class="n">attr_val</span><span class="p">.</span><span class="n">value</span><span class="p">))</span>
<span class="kr">end</span>

<span class="kd">local</span> <span class="n">ias_zone_status_change_handler</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">zigbee_message</span><span class="p">)</span>
  <span class="n">generate_event_from_zone_status</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">zigbee_message</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="n">zone_status</span><span class="p">)</span>
<span class="kr">end</span>

<span class="n">handlers</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">global</span> <span class="o">=</span> <span class="p">{},</span>
  <span class="n">cluster</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">IasZoneCluster</span><span class="p">.</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
      <span class="p">[</span><span class="n">IasZoneCluster</span><span class="p">.</span><span class="n">commands</span><span class="p">.</span><span class="n">server</span><span class="p">.</span><span class="n">ZoneStatusChangeNotification</span><span class="p">.</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">ias_zone_status_change_handler</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="n">attr</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">IasZoneCluster</span><span class="p">.</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
      <span class="p">[</span><span class="n">IasZoneCluster</span><span class="p">.</span><span class="n">attributes</span><span class="p">.</span><span class="n">ZoneStatus</span><span class="p">.</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">ias_zone_status_attr_handler</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="n">zdo</span> <span class="o">=</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="c1">-- This handlers table could then be used with the zigbee driver utils to register/build a driver</span>
</pre></div>
</div>
<p>Here we can see that we are adding one cluster specific handler and one attribute handler.  Both are for handling zone
status values.</p>
<div class="section" id="zcl-attribute-value-handler">
<h2>ZCL attribute value handler<a class="headerlink" href="#zcl-attribute-value-handler" title="Permalink to this headline">¶</a></h2>
<p>The following is a prototype definition of an attribute handler</p>
<dl class="function">
<dt id="zcl_attribute_value_handler">
<em class="property"> </em><code class="descname">zcl_attribute_value_handler</code><span class="sig-paren">(</span><em>driver</em>, <em>device</em>, <em>attr_val</em>, <em>zb_rx</em><span class="sig-paren">)</span><a class="headerlink" href="#zcl_attribute_value_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Handle an attribute value sent from the device (either via a read attribute response or a report attribute global
message).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>driver</strong> (<a class="reference internal" href="../drivers.html#Driver" title="Driver"><em>Driver</em></a>) – the driver context</li>
<li><strong>device</strong> (<a class="reference internal" href="../drivers.html#Device" title="Device"><em>Device</em></a>) – the device reporting the attribute</li>
<li><strong>attr_val</strong> (<a class="reference internal" href="data_types.html#DataType" title="DataType"><em>DataType</em></a>) – the attribute value</li>
<li><strong>zb_rx</strong> (<a class="reference internal" href="messages.html#messages.ZigbeeMessageRx" title="messages.ZigbeeMessageRx"><em>messages.ZigbeeMessageRx</em></a>) – the full Zigbee message this value is being extracted from</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>If this handler type is registered it will be nested as follows
“attr”-&gt;cluster_id-&gt;attribute_id-&gt;handler, that is, it is named as an “attr” handler, then it is associated with a
specific cluster and attribute.  When either a
<a class="reference internal" href="zcl/zcl_commands.html#read_attr_response.ReadAttributeResponse" title="read_attr_response.ReadAttributeResponse"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">read</span> <span class="pre">attribute</span> <span class="pre">response</span></code></a> or
<a class="reference internal" href="zcl/zcl_commands.html#report_attr.ReportAttribute" title="report_attr.ReportAttribute"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">report</span> <span class="pre">attribute</span></code></a> message is received matching the cluster and attribute, that
value will be passed into the handler function on receipt.  Note that a read attribute response value will only call the
handler if the status was success.</p>
<p>Following is an example. By default this is registered for cluster <cite>0x0006</cite>
(On Off cluster) attribute <cite>0x0000</cite> (On Off attribute) if the “Switch” capability is listed as supported.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">OnOffCluster</span> <span class="o">=</span> <span class="p">(</span><span class="nb">require</span> <span class="s2">&quot;st.zigbee.zcl.clusters&quot;</span><span class="p">).</span><span class="n">OnOffCluster</span>
<span class="kd">local</span> <span class="n">capabilities</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;st.capabilities&quot;</span>

<span class="c1">--- Default handler for on off attribute on the on off cluster</span>
<span class="c1">---</span>
<span class="c1">--- This converts the boolean value from true -&gt; Switch.switch.on and false to Switch.switch.off.</span>
<span class="c1">---</span>
<span class="c1">--- @param driver Driver The current driver running containing necessary context for execution</span>
<span class="c1">--- @param device ZigbeeDevice The device this message was received from containing identifying information</span>
<span class="c1">--- @param value Boolean the value of the On Off cluster On Off attribute</span>
<span class="kd">local</span> <span class="n">on_off_attr_handler</span> <span class="o">=</span> <span class="kr">function</span> <span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
  <span class="kd">local</span> <span class="n">attr</span> <span class="o">=</span> <span class="n">capabilities</span><span class="p">.</span><span class="n">switch</span><span class="p">.</span><span class="n">switch</span>
  <span class="n">device</span><span class="p">:</span><span class="n">emit_event</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">value</span> <span class="ow">and</span> <span class="n">attr</span><span class="p">.</span><span class="n">on</span><span class="p">()</span> <span class="ow">or</span> <span class="n">attr</span><span class="p">.</span><span class="n">off</span><span class="p">())</span>
<span class="kr">end</span>

<span class="kd">local</span> <span class="n">zigbee_handlers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">attr</span> <span class="o">=</span> <span class="p">{</span>
      <span class="p">[</span><span class="n">OnOffCluster</span><span class="p">.</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">OnOffCluster</span><span class="p">.</span><span class="n">attributes</span><span class="p">.</span><span class="n">OnOff</span><span class="p">.</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">on_off_attr_handler</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="zcl-global-command-handler">
<h2>ZCL global command handler<a class="headerlink" href="#zcl-global-command-handler" title="Permalink to this headline">¶</a></h2>
<p>Following is a prototype function defining a global command handler:</p>
<dl class="function">
<dt id="zcl_global_command_handler">
<em class="property"> </em><code class="descname">zcl_global_command_handler</code><span class="sig-paren">(</span><em>driver</em>, <em>device</em>, <em>zb_rx</em><span class="sig-paren">)</span><a class="headerlink" href="#zcl_global_command_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Handle a ZCL message using a global command.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>driver</strong> (<a class="reference internal" href="../drivers.html#Driver" title="Driver"><em>Driver</em></a>) – the driver context</li>
<li><strong>device</strong> (<a class="reference internal" href="../drivers.html#Device" title="Device"><em>Device</em></a>) – the device reporting the attribute</li>
<li><strong>zb_rx</strong> (<a class="reference internal" href="messages.html#messages.ZigbeeMessageRx" title="messages.ZigbeeMessageRx"><em>messages.ZigbeeMessageRx</em></a>) – the Zigbee message received</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>If this handler type is registered it will be nested as follows
“global”-&gt;cluster_id-&gt;command_id-&gt;handler, that is, it is named as an “global” handler, then it is associated with a
specific cluster and command.  When either a message is received matching the cluster and attribute, and the frame
control cluster specific flag is false, the entire parsed <a class="reference internal" href="messages.html#messages.ZigbeeMessageRx" title="messages.ZigbeeMessageRx"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">ZigbeeMessageRx</span></code></a> will
be passed into the handler.</p>
<p>Following is an example of a method that will handle any read or report
attribute message on the SmartThings specific acceleration cluster <cite>0xFC04</cite>.  This is done as a global command handler
instead of an attribute handler because we expect to receive and want to act on multiple attribute reports in a single
message, not a single attribute value.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">zcl_commands</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;st.zigbee.zcl.global_commands&quot;</span>
<span class="kd">local</span> <span class="n">capabilities</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;st.capabilities&quot;</span>

<span class="c1">--- Handler for SmartThings multi sensor threeAxis acceleration events</span>
<span class="c1">---</span>
<span class="c1">--- This is a report attribute message handler and if there are values present for each of the x y and z axis</span>
<span class="c1">--- accelerations a threeAxis event will be generated</span>
<span class="c1">---</span>
<span class="c1">--- @param driver Driver The current driver running containing necessary context for execution</span>
<span class="c1">--- @param device ZigbeeDevice The device this message was received from containing identifying information</span>
<span class="c1">--- @param zbrx ZigbeeMessageRx the message that matched the cluster and command</span>
<span class="kd">local</span> <span class="kr">function</span> <span class="nf">three_axis_report_handler</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">zbrx</span><span class="p">)</span>
  <span class="kd">local</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>
  <span class="kr">for</span> <span class="n">i</span><span class="p">,</span><span class="n">v</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">zbrx</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="n">zcl_body</span><span class="p">.</span><span class="n">attr_records</span><span class="p">)</span> <span class="kr">do</span>
    <span class="kr">if</span> <span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">attr_id</span><span class="p">.</span><span class="n">value</span> <span class="o">==</span> <span class="mh">0x0012</span><span class="p">)</span> <span class="kr">then</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">value</span>
    <span class="kr">elseif</span> <span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">attr_id</span><span class="p">.</span><span class="n">value</span> <span class="o">==</span> <span class="mh">0x0013</span><span class="p">)</span> <span class="kr">then</span>
      <span class="n">y</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">value</span>
    <span class="kr">elseif</span> <span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">attr_id</span><span class="p">.</span><span class="n">value</span> <span class="o">==</span> <span class="mh">0x0014</span><span class="p">)</span> <span class="kr">then</span>
      <span class="n">z</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">value</span>
    <span class="kr">end</span>
  <span class="kr">end</span>
  <span class="kr">if</span> <span class="n">x</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="ow">and</span> <span class="n">z</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="kr">then</span>
    <span class="n">device</span><span class="p">:</span><span class="n">emit_event</span><span class="p">(</span><span class="n">capabilities</span><span class="p">.</span><span class="n">threeAxis</span><span class="p">.</span><span class="n">threeAxis</span><span class="p">({</span><span class="n">value</span> <span class="o">=</span><span class="p">{</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">}}))</span>
  <span class="kr">end</span>
<span class="kr">end</span>

<span class="kd">local</span> <span class="n">zigbee_handlers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">global</span> <span class="o">=</span> <span class="p">{</span>
      <span class="p">[</span><span class="mh">0xFC02</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">zcl_commands</span><span class="p">.</span><span class="n">ReportAttribute</span><span class="p">.</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">three_axis_report_handler</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="zcl-cluster-command-handler">
<h2>ZCL cluster command handler<a class="headerlink" href="#zcl-cluster-command-handler" title="Permalink to this headline">¶</a></h2>
<p>Following is a prototype defining the ZCL cluster command handler</p>
<dl class="function">
<dt id="zcl_cluster_command_handler">
<em class="property"> </em><code class="descname">zcl_cluster_command_handler</code><span class="sig-paren">(</span><em>driver</em>, <em>device</em>, <em>zb_rx</em><span class="sig-paren">)</span><a class="headerlink" href="#zcl_cluster_command_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Handle a ZCL message using a cluster specific command.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>driver</strong> (<a class="reference internal" href="../drivers.html#Driver" title="Driver"><em>Driver</em></a>) – the driver context</li>
<li><strong>device</strong> (<a class="reference internal" href="../drivers.html#Device" title="Device"><em>Device</em></a>) – the device reporting the attribute</li>
<li><strong>zb_rx</strong> (<a class="reference internal" href="messages.html#messages.ZigbeeMessageRx" title="messages.ZigbeeMessageRx"><em>messages.ZigbeeMessageRx</em></a>) – the Zigbee message received</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>If this handler type is registered it will be nested as follows
“cluster”-&gt;cluster_id-&gt;command_id-&gt;handler, that is, it is named as an “cluster” handler, then it is associated with a
specific cluster and command.  When either a message is received matching the cluster and attribute, and the frame
control cluster specific flag is true, the entire parsed <a class="reference internal" href="messages.html#messages.ZigbeeMessageRx" title="messages.ZigbeeMessageRx"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">ZigbeeMessageRx</span></code></a> will
be passed into the handler.</p>
<p>There are no default handlers implemented that are cluster handlers.  However a common example for a driver would be
handling the Zone Status Change Notification command on the IAS Zone cluster.  That is a cluster specific command that
will need handling on devices that use it.  However, a default handler is not included because that message does not
map to a single event type but is instead device specific.  Following is an example of one such handler for a moisture
sensor:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">IasZoneCluster</span> <span class="o">=</span> <span class="p">(</span><span class="nb">require</span> <span class="s2">&quot;st.zigbee.zcl.clusters&quot;</span><span class="p">).</span><span class="n">IasZoneCluster</span>
<span class="kd">local</span> <span class="n">capabilities</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;st.capabilities&quot;</span>

<span class="c1">--- Handler for the cluster specific command ZoneStatusChangeNotification on the IasZoneCluster</span>
<span class="c1">---</span>
<span class="c1">--- @param driver Driver The current driver running containing necessary context for execution</span>
<span class="c1">--- @param device ZigbeeDevice The device this message was received from containing identifying information</span>
<span class="c1">--- @param zb_rx ZigbeeMessageRx the Zigbee message received</span>
<span class="kd">local</span> <span class="n">ias_zone_status_change_handler</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">zb_rx</span><span class="p">)</span>
  <span class="kd">local</span> <span class="n">zone_status</span> <span class="o">=</span> <span class="n">zb_rx</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="n">zcl_body</span><span class="p">.</span><span class="n">zone_status</span>
  <span class="n">device</span><span class="p">:</span><span class="n">emit_event</span><span class="p">(</span>
      <span class="p">(</span><span class="n">zone_status</span><span class="p">:</span><span class="n">is_alarm1_set</span><span class="p">()</span> <span class="ow">or</span> <span class="n">zone_status</span><span class="p">:</span><span class="n">is_alarm2_set</span><span class="p">())</span> <span class="ow">and</span>
          <span class="n">capabilities</span><span class="p">.</span><span class="n">waterSensor</span><span class="p">.</span><span class="n">water</span><span class="p">.</span><span class="n">wet</span><span class="p">()</span> <span class="ow">or</span>
          <span class="n">capabilities</span><span class="p">.</span><span class="n">waterSensor</span><span class="p">.</span><span class="n">water</span><span class="p">.</span><span class="n">dry</span><span class="p">()</span>
  <span class="p">)</span>
<span class="kr">end</span>

<span class="kd">local</span> <span class="n">zigbee_handlers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">cluster</span> <span class="o">=</span> <span class="p">{</span>
          <span class="p">[</span><span class="n">IasZoneCluster</span><span class="p">.</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="p">[</span><span class="n">IasZoneCluster</span><span class="p">.</span><span class="n">commands</span><span class="p">.</span><span class="n">server</span><span class="p">.</span><span class="n">ZoneStatusChangeNotification</span><span class="p">.</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">ias_zone_status_change_handler</span>
          <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="zdo-command-handler">
<h2>ZDO command handler<a class="headerlink" href="#zdo-command-handler" title="Permalink to this headline">¶</a></h2>
<p>Following is a prototype function defining a zdo handler:</p>
<dl class="function">
<dt id="zdo_handler">
<em class="property"> </em><code class="descname">zdo_handler</code><span class="sig-paren">(</span><em>driver</em>, <em>device</em>, <em>zb_rx</em><span class="sig-paren">)</span><a class="headerlink" href="#zdo_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Handle a ZCL message using a global command.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>driver</strong> (<a class="reference internal" href="../drivers.html#Driver" title="Driver"><em>Driver</em></a>) – the driver context</li>
<li><strong>device</strong> (<a class="reference internal" href="../drivers.html#Device" title="Device"><em>Device</em></a>) – the device reporting the attribute</li>
<li><strong>zb_rx</strong> (<a class="reference internal" href="messages.html#messages.ZigbeeMessageRx" title="messages.ZigbeeMessageRx"><em>messages.ZigbeeMessageRx</em></a>) – the Zigbee message received</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>If this handler type is registered it will be nested as follows
“zdo”-&gt;cluster_id-&gt;handler, that is, it is named as an “zdo” handler, then it is associated with a
specific cluster.  When  a message is received matching the cluster and profile (zdo) the entire parsed
<a class="reference internal" href="messages.html#messages.ZigbeeMessageRx" title="messages.ZigbeeMessageRx"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">ZigbeeMessageRx</span></code></a> will be passed into the handler.  There are not currently any
examples using these, and it is unlikely you will need one for your drivers.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">SmartThings Lua Libraries</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../lua_environment.html">Lua Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils.html">Utils Library</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="zigbee.html">Zigbee related libraries</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="drivers.html">Zigbee driver sturctures</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Zigbee Driver RX message handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="tx_handlers.html">Zigbee Driver Capability Command Handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="messages.html">Zigbee Messages</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_types.html">Zigbee Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="zcl/zcl_commands.html">ZCL Global Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="zdo/zdo_commands.html">ZDO Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="zcl/zcl_clusters.html">ZCL Clusters</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated.html">Generated Zigbee Code</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../drivers.html">Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver_tests.html">Driver Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datastore.html">Datastore</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="zigbee.html">Zigbee related libraries</a><ul>
      <li>Previous: <a href="drivers.html" title="previous chapter">Zigbee driver sturctures</a></li>
      <li>Next: <a href="tx_handlers.html" title="next chapter">Zigbee Driver Capability Command Handlers</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, SmartThings Developers.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/zigbee/rx_handlers.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>