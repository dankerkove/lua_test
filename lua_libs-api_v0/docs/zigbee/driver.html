

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Zigbee driver structures &mdash; SmartThings Edge Device Drivers  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="SmartThings Edge Device Drivers  documentation" href="../index.html"/>
        <link rel="up" title="Zigbee Libraries" href="zigbee.html"/>
        <link rel="next" title="ZigbeeDevice Class" href="device.html"/>
        <link rel="prev" title="Zigbee Libraries" href="zigbee.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> SmartThings Edge Device Drivers
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Guides:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../guides/getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/first-driver.html">Writing your first Lua driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/package.html">Package Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/lan.html">LAN Edge Device Driver Development Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/rpc-client.html">Writing an RPC Client Driver</a></li>
</ul>
<p class="caption"><span class="caption-text">References:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../lua_environment.html">Lua Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../log.html">Logging Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils.html">Utils Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../buf.html">Buffer Library</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="zigbee.html">Zigbee Libraries</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Zigbee driver structures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#zigbee-handlers">zigbee_handlers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example">example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#cluster-configurations">cluster_configurations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configured-attribute">configured attribute</a></li>
<li class="toctree-l4"><a class="reference internal" href="#monitored-attribute">monitored attribute</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#zigbeedriver-class-documentation">ZigbeeDriver Class Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#attribute-configuration-documentation">Attribute Configuration Documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="device.html">ZigbeeDevice Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="zigbee_message_handlers.html">Zigbee Driver RX message handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="defaults.html">Zigbee Driver Capability Defaults</a></li>
<li class="toctree-l2"><a class="reference internal" href="messages.html">Zigbee Messages</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_types.html">Zigbee Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="zcl/zcl_commands.html">ZCL Global Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="zcl/zcl_clusters.html">ZCL Clusters</a></li>
<li class="toctree-l2"><a class="reference internal" href="zdo/zdo_commands.html">ZDO Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated.html">Generated Zigbee Code</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../zwave/zwave.html">Z-Wave Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../drivers.html">Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../capabilities.html">Capabilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../device.html">Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dispatchers.html">Dispatchers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver_tests.html">Driver Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datastore.html">Datastore</a></li>
<li class="toctree-l1"><a class="reference internal" href="../socket.html">Socket Library</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SmartThings Edge Device Drivers</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../reference/index.html">&lt;no title&gt;</a> &raquo;</li>
        
          <li><a href="zigbee.html">Zigbee Libraries</a> &raquo;</li>
        
      <li>Zigbee driver structures</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/zigbee/driver.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="zigbee-driver-structures">
<h1>Zigbee driver structures<a class="headerlink" href="#zigbee-driver-structures" title="Permalink to this headline">¶</a></h1>
<p>A ZigbeeDriver is an extension of the <a class="reference internal" href="../drivers.html#Driver" title="Driver"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">Driver</span></code></a> and contains some more specific structures that are
only applicable to a Zigbee device.</p>
<div class="section" id="zigbee-handlers">
<span id="id1"></span><h2>zigbee_handlers<a class="headerlink" href="#zigbee-handlers" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">zigbee_handlers</span></code> are the most common additional field you will be adding to the driver template used to build
your driver.  The <code class="docutils literal notranslate"><span class="pre">zigbee_handlers</span></code> structure is used to register message handlers for any message coming from the
device that you may need to convert to a SmartThings capability event, or use as state to manage the continued execution
of the device.  Detailed information on the types of handlers as well as the structure of the table can be found
on the <a class="reference internal" href="zigbee_message_handlers.html"><span class="doc">RX message handlers</span></a> page.</p>
<p>There are some additional caveats to take into account when setting these up in your driver.  First is the interaction
between <code class="docutils literal notranslate"><span class="pre">zigbee_handlers</span></code> you define in your driver template, and handlers defined in
<span class="xref std std-doc">default Zigbee behavior</span> that you pull in using the <code class="docutils literal notranslate"><span class="pre">defaults.register_for_default_handlers</span></code>
call.  The handlers you provide directly in your driver template will take precedence over any default behavior that
would be present.  More concretely, if you provide a handler for the OnOff attribute of the OnOff cluster in your driver
template, but then call to register defaults for the switch capability (which also provides a handler for that cluster
and attribute); your handler would be the one called with the message.  In this way you can
choose to only override the specific handlers in which your device strays from the standard behavior.</p>
<p>Another note is that each registered “handler” can be either a function, or a list of functions.  If you provide a list
EACH function in that list will be called with the same message.</p>
<div class="section" id="example">
<h3>example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>Following is an example creating a simple set of <code class="docutils literal notranslate"><span class="pre">zigbee_handlers</span></code> for a Zigbee switch that supports switch and level
(<a class="reference internal" href="#cluster-configurations"><span class="std std-ref">cluster_configurations</span></a>, default handlers, and <code class="docutils literal notranslate"><span class="pre">capability_handlers</span></code> omitted for
example simplicity).</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">capabilities</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;st.capabilities&quot;</span>
<span class="kd">local</span> <span class="n">ZigbeeDriver</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;st.zigbee&quot;</span>
<span class="kd">local</span> <span class="n">clusters</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;st.zigbee.zcl.clusters&quot;</span>
<span class="kd">local</span> <span class="n">OnOffCluster</span> <span class="o">=</span> <span class="n">clusters</span><span class="p">.</span><span class="n">OnOffCluster</span>
<span class="kd">local</span> <span class="n">LevelControlCluster</span> <span class="o">=</span> <span class="n">clusters</span><span class="p">.</span><span class="n">LevelControlCluster</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">on_off_attr_handler</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
  <span class="kd">local</span> <span class="n">attr</span> <span class="o">=</span> <span class="n">capabilities</span><span class="p">.</span><span class="n">switch</span><span class="p">.</span><span class="n">switch</span>
  <span class="n">device</span><span class="p">:</span><span class="n">emit_event</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">value</span> <span class="ow">and</span> <span class="n">attr</span><span class="p">.</span><span class="n">on</span><span class="p">()</span> <span class="ow">or</span> <span class="n">attr</span><span class="p">.</span><span class="n">off</span><span class="p">())</span>
<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">level_attr_handler</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
  <span class="n">device</span><span class="p">:</span><span class="n">emit_event</span><span class="p">(</span><span class="n">capabilities</span><span class="p">.</span><span class="n">switchLevel</span><span class="p">.</span><span class="n">level</span><span class="p">(</span><span class="nb">math.floor</span><span class="p">((</span><span class="n">value</span><span class="p">.</span><span class="n">value</span> <span class="o">/</span> <span class="mf">254.0</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)))</span>
<span class="kr">end</span>

<span class="kd">local</span> <span class="n">zigbee_switch_driver_template</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">supported_capabilities</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">capabilities</span><span class="p">.</span><span class="n">switch</span><span class="p">,</span>
    <span class="n">capabilities</span><span class="p">.</span><span class="n">switchLevel</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="n">zigbee_handlers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">global</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="n">cluster</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="n">attr</span> <span class="o">=</span> <span class="p">{</span>
      <span class="p">[</span><span class="n">OnOffCluster</span><span class="p">.</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">OnOffCluster</span><span class="p">.</span><span class="n">attributes</span><span class="p">.</span><span class="n">OnOff</span><span class="p">.</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">on_off_attr_handler</span>
      <span class="p">},</span>
      <span class="p">[</span><span class="n">LevelControlCluster</span><span class="p">.</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">LevelControlCluster</span><span class="p">.</span><span class="n">attributes</span><span class="p">.</span><span class="n">CurrentLevel</span><span class="p">.</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">level_attr_handler</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">local</span> <span class="n">zigbee_bulb</span> <span class="o">=</span> <span class="n">ZigbeeDriver</span><span class="p">(</span><span class="s2">&quot;zigbee-switch&quot;</span><span class="p">,</span> <span class="n">zigbee_bulb_driver_template</span><span class="p">)</span>
<span class="n">zigbee_bulb</span><span class="p">:</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="cluster-configurations">
<span id="id2"></span><h2>cluster_configurations<a class="headerlink" href="#cluster-configurations" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">cluster_configurations</span></code> are another ZigbeeDriver template option that maps pretty closely to the
<a class="reference internal" href="zcl/zcl_commands.html#config_reporting.ConfigureReporting" title="config_reporting.ConfigureReporting"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">ConfigureReporting</span></code></a> Zigbee command.  These configurations are used to
drive how we configure a device newly joined to the hub to inform us of changes in state.  See the class
<a class="reference internal" href="#AttributeConfiguration" title="AttributeConfiguration"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">AttributeConfiguration</span></code></a> for exactly what components go into each record.  There are 2 use cases for these
configurations and they can be controlled using the two optional fields <code class="docutils literal notranslate"><span class="pre">configurable</span></code> and <code class="docutils literal notranslate"><span class="pre">monitored</span></code>.</p>
<p>These configurations should be grouped into lists, under the key of the capability ID they are associated with.  This is
used in terms of registering defaults, if you define a set of configurations on your driver under a given capability,
the corresponding defaults will not be included even if you call to register them.</p>
<div class="section" id="configured-attribute">
<h3>configured attribute<a class="headerlink" href="#configured-attribute" title="Permalink to this headline">¶</a></h3>
<p>An <code class="docutils literal notranslate"><span class="pre">AttributeConfiguration</span></code> that has <code class="docutils literal notranslate"><span class="pre">configurable</span></code> set to true (which is the default if it is not explicitly set),
will result in a <a class="reference internal" href="zcl/zcl_commands.html#config_reporting.ConfigureReporting" title="config_reporting.ConfigureReporting"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">ConfigureReporting</span></code></a> command being sent to the device
when <code class="docutils literal notranslate"><span class="pre">ZigbeeDevice:configure</span></code> is called (by default hooked up to the capability command <code class="docutils literal notranslate"><span class="pre">configuration.configure</span></code>).
This means that if the device supports reporting, it will send an
<a class="reference internal" href="zcl/zcl_commands.html#report_attr.ReportAttribute" title="report_attr.ReportAttribute"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">ReportAttribute</span></code></a> command to the hub when the corresponding attribute
changes according the the other paramaters.</p>
<p>An <code class="docutils literal notranslate"><span class="pre">AttributeConfiguration</span></code> that has this field set to false will not send the commands to configure reporting.  One
common example of this would be a ZLL device as the ZLL profile does not support reporting.</p>
</div>
<div class="section" id="monitored-attribute">
<h3>monitored attribute<a class="headerlink" href="#monitored-attribute" title="Permalink to this headline">¶</a></h3>
<p>An <code class="docutils literal notranslate"><span class="pre">AttributeConfiguration</span></code> that has <code class="docutils literal notranslate"><span class="pre">monitored</span></code> set to true (which is the default if it is not explicitly set),
will enroll that attribute to be tracked by the driver.  What this means is that each time that attribute is reported,
or we receive a <a class="reference internal" href="zcl/zcl_commands.html#read_attr_response.ReadAttributeResponse" title="read_attr_response.ReadAttributeResponse"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">read</span> <span class="pre">attribute</span> <span class="pre">response</span></code></a> the driver will
keep a timestamp.  Then, periodically (on a 30 second interval) all monitored attributes will be checked, and if any of
those attributes hasn’t reported in 1.5x the <code class="docutils literal notranslate"><span class="pre">maximum_interval</span></code> a
<a class="reference internal" href="zcl/zcl_commands.html#read_attr.ReadAttribute" title="read_attr.ReadAttribute"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">ReadAttribute</span></code></a> command will be sent to try to refresh the attribute value,
and will continue to be sent every 1.5x the <code class="docutils literal notranslate"><span class="pre">maximum_interval</span></code> until it is heard from again.  For most Zigbee devices
behaving well, these read attribute commands will never need to be sent, but if network congestions causes a missed
report, this can keep us from being out of date for too long.  The most common use case for this is again ZLL devices
which, if changed out of band (e.g. a physical switch is turned off then on), we will not know about until we poll.</p>
</div>
<div class="section" id="id3">
<h3>example<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>Following is an example creating a simple set of <code class="docutils literal notranslate"><span class="pre">attribute_configurations</span></code> for a Zigbee switch that supports switch
and level (<a class="reference internal" href="#zigbee-handlers"><span class="std std-ref">zigbee_handlers</span></a>, default handlers, and <code class="docutils literal notranslate"><span class="pre">capability_handlers</span></code> omitted for
example simplicity).</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">capabilities</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;st.capabilities&quot;</span>
<span class="kd">local</span> <span class="n">ZigbeeDriver</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;st.zigbee&quot;</span>
<span class="kd">local</span> <span class="n">clusters</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;st.zigbee.zcl.clusters&quot;</span>
<span class="kd">local</span> <span class="n">OnOffCluster</span> <span class="o">=</span> <span class="n">clusters</span><span class="p">.</span><span class="n">OnOffCluster</span>
<span class="kd">local</span> <span class="n">LevelControlCluster</span> <span class="o">=</span> <span class="n">clusters</span><span class="p">.</span><span class="n">LevelControlCluster</span>
<span class="kd">local</span> <span class="n">data_types</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;st.zigbee.data_types&quot;</span>

<span class="kd">local</span> <span class="n">zigbee_switch_driver_template</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">supported_capabilities</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">capabilities</span><span class="p">.</span><span class="n">switch</span><span class="p">,</span>
    <span class="n">capabilities</span><span class="p">.</span><span class="n">switchLevel</span><span class="p">,</span>
  <span class="p">},</span>
    <span class="n">cluster_configurations</span> <span class="o">=</span> <span class="p">{</span>
      <span class="p">[</span><span class="n">capabilities</span><span class="p">.</span><span class="n">switch</span><span class="p">.</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">{</span>
            <span class="n">cluster</span> <span class="o">=</span> <span class="n">zcl_clusters</span><span class="p">.</span><span class="n">OnOffCluster</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span>
            <span class="n">attribute</span> <span class="o">=</span> <span class="n">zcl_clusters</span><span class="p">.</span><span class="n">OnOffCluster</span><span class="p">.</span><span class="n">attributes</span><span class="p">.</span><span class="n">OnOff</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span>
            <span class="n">minimum_interval</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">maximum_interval</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
            <span class="n">data_type</span> <span class="o">=</span> <span class="n">data_types</span><span class="p">.</span><span class="n">Boolean</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">[</span><span class="n">capabilities</span><span class="p">.</span><span class="n">switchLevel</span><span class="p">.</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">{</span>
          <span class="n">cluster</span> <span class="o">=</span> <span class="n">zcl_clusters</span><span class="p">.</span><span class="n">LevelControlCluster</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span>
          <span class="n">attribute</span> <span class="o">=</span> <span class="n">zcl_clusters</span><span class="p">.</span><span class="n">LevelControlCluster</span><span class="p">.</span><span class="n">attributes</span><span class="p">.</span><span class="n">CurrentLevel</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span>
          <span class="n">minimum_interval</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
          <span class="n">maximum_interval</span> <span class="o">=</span> <span class="mi">3600</span><span class="p">,</span>
          <span class="n">data_type</span> <span class="o">=</span> <span class="n">data_types</span><span class="p">.</span><span class="n">Uint8</span><span class="p">,</span>
          <span class="n">reportable_change</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">local</span> <span class="n">zigbee_bulb</span> <span class="o">=</span> <span class="n">ZigbeeDriver</span><span class="p">(</span><span class="s2">&quot;zigbee-switch&quot;</span><span class="p">,</span> <span class="n">zigbee_bulb_driver_template</span><span class="p">)</span>
<span class="n">zigbee_bulb</span><span class="p">:</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="zigbeedriver-class-documentation">
<h2>ZigbeeDriver Class Documentation<a class="headerlink" href="#zigbeedriver-class-documentation" title="Permalink to this headline">¶</a></h2>
<dl class="lua class">
<dt id="ZigbeeDriver">
<em class="property">class </em><code class="sig-name descname">ZigbeeDriver</code><em class="property">: </em><a class="reference internal" href="../drivers.html#Driver" title="Driver">Driver</a><a class="headerlink" href="#ZigbeeDriver" title="Permalink to this definition">¶</a></dt>
<dd><dl class="lua attribute">
<dt id="ZigbeeDriver.zigbee_channel">
<code class="sig-name descname">zigbee_channel</code><em class="property">: </em>message_channel<a class="headerlink" href="#ZigbeeDriver.zigbee_channel" title="Permalink to this definition">¶</a></dt>
<dd><p>the communication channel for Zigbee devices</p>
</dd></dl>

<dl class="lua attribute">
<dt id="ZigbeeDriver.cluster_configurations">
<code class="sig-name descname">cluster_configurations</code><em class="property">: </em>list[AttributeConfiguration]<a class="headerlink" href="#ZigbeeDriver.cluster_configurations" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of configurations for reporting attributes</p>
</dd></dl>

<dl class="lua attribute">
<dt id="ZigbeeDriver.zigbee_handlers">
<code class="sig-name descname">zigbee_handlers</code><em class="property">: </em>table<a class="headerlink" href="#ZigbeeDriver.zigbee_handlers" title="Permalink to this definition">¶</a></dt>
<dd><p>A structure definining different ZigbeeHandlers mapped to what they handle (only used on creation)</p>
</dd></dl>

<dl class="lua method">
<dt id="ZigbeeDriver.zigbee_message_handler">
<em class="property"> </em><code class="sig-name descname">zigbee_message_handler</code><span class="sig-paren">(</span><em class="sig-param">self</em>, <em class="sig-param">message_channel</em><span class="sig-paren">)</span><a class="headerlink" href="#ZigbeeDriver.zigbee_message_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Handler function for the raw zigbee channel message receive</p>
<p>This will be the default registered handler for the Zigbee message_channel receive callback.  It will parse the
raw serialized message into a ZigbeeMessageRx and then use the zigbee_message_dispatcher to find a handler that
can deal with it.</p>
<p>Handlers have various levels of specificity.  Global handlers are for global ZCL commands, and are specified with a
cluster, then command ID.  Cluster handlers are for cluster specific commands and are again defined by cluster, then
command id.  Attr handlers are used for an attribute report, or read response for a specific cluster, attribute ID.
and finally zdo handlers are for ZDO commands and are defined by the “cluster” of the command.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>self</strong> (<a class="reference internal" href="../drivers.html#Driver" title="Driver"><em>Driver</em></a>) – the driver context</p></li>
<li><p><strong>message_channel</strong> (<em>message_channel</em>) – the Zigbee message_channel with a message ready to be read</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="lua staticmethod">
<dt id="ZigbeeDriver.populate_zigbee_dispatcher_from_sub_drivers">
<em class="property">static </em><code class="sig-name descname">populate_zigbee_dispatcher_from_sub_drivers</code><span class="sig-paren">(</span><em class="sig-param">driver</em><span class="sig-paren">)</span><a class="headerlink" href="#ZigbeeDriver.populate_zigbee_dispatcher_from_sub_drivers" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a number of child handlers that override the top level driver behavior</p>
<p>Each handler set can contain a <cite>handlers</cite> field that follow exactly the same
pattern as the base driver format. It must also contain a
<cite>zigbee_can_handle(driver, device, zb_rx)</cite> function that returns true if the
corresponding handlers should be considered.</p>
<p>This will recursively follow the <cite>sub_drivers</cite> and build a structure that will
correctly find and execute a handler that matches.  It should be noted that a child handler
will always be preferred over a handler at the same level, but that if multiple child
handlers report that they can handle a message, it will be sent to each handler that reports
it can handle the message.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>driver</strong> (<a class="reference internal" href="../drivers.html#Driver" title="Driver"><em>Driver</em></a>) – the executing zigbee driver (or sub handler set)</p>
</dd>
</dl>
</dd></dl>

<dl class="lua staticmethod">
<dt id="ZigbeeDriver.init">
<em class="property">static </em><code class="sig-name descname">init</code><span class="sig-paren">(</span><em class="sig-param">cls</em>, <em class="sig-param">name</em>, <em class="sig-param">driver_template</em><span class="sig-paren">)</span><a class="headerlink" href="#ZigbeeDriver.init" title="Permalink to this definition">¶</a></dt>
<dd><p>Build a Zigbee driver from the specified template</p>
<p>This can be used to, given a template, build a Zigbee driver that can be run to support devices.  The name field is
used for logging and other debugging purposes.  The driver should also include a set of
capability_handlers and zigbee_handlers to handle messages for the corresponding message types.  It is recommended
that you use the call syntax on the ZigbeeDriver to execute this (e.g. ZigbeeDriver(“my_driver”, {}) )</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cls</strong> (<em>table</em>) – the class to be instantiated (ZigbeeDriver)</p></li>
<li><p><strong>name</strong> (<em>str</em>) – the name of this driver</p></li>
<li><p><strong>driver_template</strong> (<em>table</em>) – a template providing information on the driver and it’s handlers</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the constructed Zigbee driver</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="../drivers.html#Driver" title="Driver">Driver</a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="attribute-configuration-documentation">
<span id="attribute-configuration"></span><h2>Attribute Configuration Documentation<a class="headerlink" href="#attribute-configuration-documentation" title="Permalink to this headline">¶</a></h2>
<dl class="lua class">
<dt id="AttributeConfiguration">
<em class="property">class </em><code class="sig-name descname">AttributeConfiguration</code><a class="headerlink" href="#AttributeConfiguration" title="Permalink to this definition">¶</a></dt>
<dd><dl class="lua attribute">
<dt id="AttributeConfiguration.cluster">
<code class="sig-name descname">cluster</code><em class="property">: </em>number<a class="headerlink" href="#AttributeConfiguration.cluster" title="Permalink to this definition">¶</a></dt>
<dd><p>Cluster ID this attribute is a part of</p>
</dd></dl>

<dl class="lua attribute">
<dt id="AttributeConfiguration.attr">
<code class="sig-name descname">attr</code><em class="property">: </em>number<a class="headerlink" href="#AttributeConfiguration.attr" title="Permalink to this definition">¶</a></dt>
<dd><p>the attribute ID</p>
</dd></dl>

<dl class="lua attribute">
<dt id="AttributeConfiguration.minimum_interval">
<code class="sig-name descname">minimum_interval</code><em class="property">: </em>number<a class="headerlink" href="#AttributeConfiguration.minimum_interval" title="Permalink to this definition">¶</a></dt>
<dd><p>the minimum reporting interval for this configuration</p>
</dd></dl>

<dl class="lua attribute">
<dt id="AttributeConfiguration.maximum_interval">
<code class="sig-name descname">maximum_interval</code><em class="property">: </em>number<a class="headerlink" href="#AttributeConfiguration.maximum_interval" title="Permalink to this definition">¶</a></dt>
<dd><p>the maximum reporting interval for this configuration</p>
</dd></dl>

<dl class="lua attribute">
<dt id="AttributeConfiguration.data_type">
<code class="sig-name descname">data_type</code><em class="property">: </em>DataType<a class="headerlink" href="#AttributeConfiguration.data_type" title="Permalink to this definition">¶</a></dt>
<dd><p>the data type class for this attribute</p>
</dd></dl>

<dl class="lua attribute">
<dt id="AttributeConfiguration.rep_change">
<code class="sig-name descname">rep_change</code><em class="property">: </em>DataType<a class="headerlink" href="#AttributeConfiguration.rep_change" title="Permalink to this definition">¶</a></dt>
<dd><p>(optional) the amount of change needed to trigger a report.  Only necessary for non-discrete attributes</p>
</dd></dl>

<dl class="lua attribute">
<dt id="AttributeConfiguration.configurable">
<code class="sig-name descname">configurable</code><em class="property">: </em>boolean<a class="headerlink" href="#AttributeConfiguration.configurable" title="Permalink to this definition">¶</a></dt>
<dd><p>(optional default = true) Should this result in a Configure Reporting command to the device</p>
</dd></dl>

<dl class="lua attribute">
<dt id="AttributeConfiguration.monitored">
<code class="sig-name descname">monitored</code><em class="property">: </em>boolean<a class="headerlink" href="#AttributeConfiguration.monitored" title="Permalink to this definition">¶</a></dt>
<dd><p>(optional default = true) Should this result in a expected report monitoring</p>
</dd></dl>

</dd></dl>

</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="device.html" class="btn btn-neutral float-right" title="ZigbeeDevice Class" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="zigbee.html" class="btn btn-neutral" title="Zigbee Libraries" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, SmartThings Developers.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> and ❤️  using a custom <a href="https://github.com/LinxiFan/Sphinx-theme">theme</a> based on <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>